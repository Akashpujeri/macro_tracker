{% extends 'tracker/base.html' %}
{% load static %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/daily_activity.css' %}">
{% endblock %}

{% block content %}
<div class="container mx-auto p-6 animate-fade-in">
  <h2 class="text-2xl font-bold mb-4 flex items-center">
    ðŸ¥— <span class="ml-2">Activity for {{ selected_date|date:"F d, Y" }}</span>
  </h2>

  {% if entries %}
    <div class="overflow-x-auto">
      <table class="min-w-full bg-white shadow-md rounded-lg">
        <thead class="bg-gray-100 text-gray-700 uppercase text-sm">
          <tr>
            <th class="py-3 px-4 text-left">Date</th>
            <th class="py-3 px-4 text-left">Food</th>
            <th class="py-3 px-4 text-left">Calories</th>
            <th class="py-3 px-4 text-left">Protein</th>
            <th class="py-3 px-4 text-left">Carbs</th>
            <th class="py-3 px-4 text-left">Fats</th>
            <th class="py-3 px-4 text-center">Actions</th>
          </tr>
        </thead>
        <tbody class="text-gray-700">
          {% for entry in entries %}
            <tr class="border-b hover:bg-gray-50">
              <td class="py-2 px-4">{{ entry.date }}</td>
              <td class="py-2 px-4">{{ entry.food_name }}</td>
              <td class="py-2 px-4">{{ entry.calories }}</td>
              <td class="py-2 px-4">{{ entry.protein }}</td>
              <td class="py-2 px-4">{{ entry.carbs }}</td>
              <td class="py-2 px-4">{{ entry.fat }}</td>
              <td class="py-2 px-4 text-center">
                <div class="flex justify-center items-center space-x-2">
                  <a href="{% url 'edit_entry' entry.id %}" 
                     class="edit-btn">
                    Edit
                  </a>
                  <form action="{% url 'delete_entry' entry.id %}" method="post" onsubmit="return confirm('Are you sure you want to delete this entry?');">
                    {% csrf_token %}
                    <button type="submit" 
                            class="delete-btn">
                      Delete
                    </button>
                  </form>
                </div>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Chart -->
    <div class="max-w-lg mx-auto mt-10">
      <canvas id="macroChart"></canvas>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      const ctx = document.getElementById('macroChart').getContext('2d');
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['Protein', 'Carbs', 'Fats'],
          datasets: [{
            label: 'Grams',
            data: [{{ total_protein }}, {{ total_carbs }}, {{ total_fats }}],
            backgroundColor: ['#4ade80', '#60a5fa', '#facc15'],
            borderRadius: 6
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false },
            title: {
              display: true,
              text: 'Macronutrient Breakdown',
              font: { size: 18 }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: { stepSize: 10 }
            }
          }
        }
      });
    </script>
  {% else %}
    <p class="text-gray-600 mt-4">No entries for {{ selected_date|date:"F d, Y" }}.</p>
  {% endif %}
</div>

{% endblock %}
